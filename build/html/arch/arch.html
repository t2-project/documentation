
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Architecture Overview &#8212; T2 Store  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Run on a Kubernetes Cluster" href="../guides/kube.html" />
    <link rel="prev" title="T2 Store Documentation" href="../index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="architecture-overview">
<span id="arch"></span><h1>Architecture Overview<a class="headerlink" href="#architecture-overview" title="Permalink to this headline">¶</a></h1>
<p>The T2 Store consists of seven services.</p>
<img alt="../_images/component_total_colour.jpg" src="../_images/component_total_colour.jpg" />
<p>The green and blue services are the core T2 Services. The blue ones are participate in the saga, the green ones do not.
The white things are databases and external services.</p>
<ul class="simple">
<li><strong>UI</strong> : The application frontend.</li>
<li><strong>UIBackend</strong> : API Gateway for the UI.</li>
<li><strong>Cart</strong> : Manages the user shopping carts. It saves the cart contents to the <em>cart repository</em>.</li>
<li><strong>Orchestrator</strong> : Manages the saga.</li>
<li><strong>Order</strong> : Persists orders to the <em>order repository</em> and marks them as either <em>success</em> or <em>failure</em>.</li>
<li><strong>Payment</strong> : Handles the store’s payment by contacting an external payment provider.</li>
<li><strong>Inventory</strong>: Manages the store’s products. They are stored in the <em>product repository</em>.</li>
</ul>
<p>The UIBackend communicates over HTTP with a REST like interface.
The Saga participants (marked in blue) use message based communication among each other.
This is necessary because of the saga pattern.</p>
<p>The T2 Store realizes the following business process:</p>
<img alt="../_images/bpmn_sub.png" src="../_images/bpmn_sub.png" />
<p>The activities within the <em>Saga</em> subprocess must be executed as a transaction.
The transaction is implemented according to the <a class="reference external" href="https://microservices.io/patterns/data/saga.html">Saga Pattern</a>.</p>
<p>The T2 Store’s services realise the activities of the business process like this:</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="82%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Service</th>
<th class="head">Activity</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Cart</td>
<td>add item to cart</td>
</tr>
<tr class="row-odd"><td>Inventory</td>
<td>add reservation, delete reservation, commit reservation</td>
</tr>
<tr class="row-even"><td>Order</td>
<td>create order, reject order</td>
</tr>
<tr class="row-odd"><td>Payment</td>
<td>do payment</td>
</tr>
<tr class="row-even"><td>Orchestrator</td>
<td>confirm order</td>
</tr>
</tbody>
</table>
<div class="section" id="the-saga">
<h2>The Saga<a class="headerlink" href="#the-saga" title="Permalink to this headline">¶</a></h2>
<p>The T2 Store’s saga is composed of the following steps:</p>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="16%" />
<col width="35%" />
<col width="42%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Step</th>
<th class="head">Service</th>
<th class="head">Transaction</th>
<th class="head">Compensation</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Inventory</td>
<td>&#160;</td>
<td>cancelReservations()</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>Order</td>
<td>createOrder()</td>
<td>rejectOrder()</td>
</tr>
<tr class="row-even"><td>3</td>
<td>Payment</td>
<td>doPayment()</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>Inventory</td>
<td>commitReservations()</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>The doPayment() step is the saga’s pivot transaction.
If this step succeeds, the saga runs to completion.</p>
<p>The step commitReservations() is designed to be retrieable.
It will succeed eventually.</p>
<p>The same applies to the compensations rejectOrder() and cancelReservations().</p>
<p>Every order is persisted, those that succeeded as well as those that failed.
An order holds, among other details, the order state.
Upon creation the order state is set to <em>success</em>.
As all orders should be persisted, the compensation of creating an order is to set its state to <em>failed</em>.
Currently an order cannot be cancelled after submission to the orchestrator.</p>
<p>The inventory manages the number of available units per product.
If the inventory decreases the number of available units only after placing the order, the product may not be available anymore because another user bought to many units of that product.
To prevent such failures the ordered units of a product are locked as soon as they are placed in the shopping cart.
As there is now no action to perform on the inventory before the pivot transaction (do payment), there is only the compensation that deletes the reservation (in case the saga rolls back) or the step commitReservations() that handles served reservations.</p>
</div>
<div class="section" id="frameworks-dependencies-and-others">
<h2>Frameworks, Dependencies and Others<a class="headerlink" href="#frameworks-dependencies-and-others" title="Permalink to this headline">¶</a></h2>
<p>The T2 Store uses the following frameworks (and services):</p>
<div class="section" id="spring-and-spring-boot">
<h3>Spring and Spring Boot<a class="headerlink" href="#spring-and-spring-boot" title="Permalink to this headline">¶</a></h3>
<p>It’s Spring. Deal with it.</p>
<table border="1" class="docutils">
<colgroup>
<col width="58%" />
<col width="42%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Dependency</th>
<th class="head">Version</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Spring Boot</td>
<td>2.4.4</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="eventuate-tram-and-eventuate-tram-saga">
<h3>Eventuate Tram and Eventuate Tram Saga<a class="headerlink" href="#eventuate-tram-and-eventuate-tram-saga" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/eventuate-tram/eventuate-tram-core">Eventuate Tram</a> is a framework for Transactional Messaging and <a class="reference external" href="https://github.com/eventuate-tram/eventuate-tram-sagas">Eventuate Tram Sagas</a> is a framework for saga orchestration.
They are both work on top of Spring / Spring Boot.
The T2 Store uses the Eventuate Tram Core framework with Kafka as the message broker and Postgres as the database.</p>
<div class="section" id="versions">
<h4>Versions<a class="headerlink" href="#versions" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="62%" />
<col width="38%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Dependency</th>
<th class="head">Version</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>io.eventuate.tram.core</td>
<td>0.29.0.RELEASE</td>
</tr>
<tr class="row-odd"><td>io.eventuate.tram.sagas</td>
<td>0.18.0.RELEASE</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="eventuate-cdc-service">
<h3>Eventuate CDC Service<a class="headerlink" href="#eventuate-cdc-service" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://eventuate.io/docs/manual/eventuate-tram/latest/cdc-configuration.html">Eventuate CDC Service</a> realizes the <a class="reference external" href="https://microservices.io/patterns/data/transactional-outbox.html">Transactional Outboxing Pattern</a> required by the Saga Pattern.</p>
<table border="1" class="docutils">
<colgroup>
<col width="71%" />
<col width="29%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Dependency</th>
<th class="head">Version</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>eventuateio/eventuate-cdc-service</td>
<td>latest</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="message-broker">
<h3>Message Broker<a class="headerlink" href="#message-broker" title="Permalink to this headline">¶</a></h3>
<p>The T2 Store uses Kafka as message broker.
It uses these images:</p>
<ul class="simple">
<li>Kafka : <a class="reference external" href="http://gcr.io/google_containers/kubernetes-kafka:1.0-10.2.1">gcr.io/google_containers/kubernetes-kafka:1.0-10.2.1</a></li>
<li>Zookeeper : <a class="reference external" href="http://gcr.io/google_containers/kubernetes-zookeeper:1.0-3.4.10">gcr.io/google_containers/kubernetes-zookeeper:1.0-3.4.10</a></li>
</ul>
</div>
<div class="section" id="saga-database">
<h3>Saga Database<a class="headerlink" href="#saga-database" title="Permalink to this headline">¶</a></h3>
<p>The T2 Store uses a Postgres Database for the saga data.
It uses the Postgres image from <a class="reference external" href="https://hub.docker.com/r/eventuateio/eventuate-postgres">eventuateio</a> because it already contains the tables required for the transactional outboxing.</p>
</div>
<div class="section" id="domain-database">
<h3>Domain Database<a class="headerlink" href="#domain-database" title="Permalink to this headline">¶</a></h3>
<p>The T2 Store uses MongoDBs as databases for the domain data.
Thus the repositories <em>cart repository</em>, <em>product repository</em> and <em>order repository</em> are MongoDBs.</p>
</div>
<div class="section" id="prometheus">
<h3>Prometheus<a class="headerlink" href="#prometheus" title="Permalink to this headline">¶</a></h3>
<p>TODO Dependency, Version, ….</p>
</div>
<div class="section" id="open-tracing-and-jaeger">
<h3>Open-tracing and Jaeger<a class="headerlink" href="#open-tracing-and-jaeger" title="Permalink to this headline">¶</a></h3>
<p>TODO Dependency, Version, ….</p>
</div>
</div>
<div class="section" id="the-services">
<h2>The Services<a class="headerlink" href="#the-services" title="Permalink to this headline">¶</a></h2>
<p>All Services are implemented as <a class="reference external" href="https://spring.io/projects/spring-boot">Spring Boot</a> Applications.
This is the services’ general package structure:</p>
<ul class="simple">
<li><code class="file docutils literal notranslate"><span class="pre">de.unistuttgart.t2.&lt;service-name&gt;</span></code></li>
<li><code class="file docutils literal notranslate"><span class="pre">de.unistuttgart.t2.&lt;service-name&gt;.saga</span></code></li>
<li><code class="file docutils literal notranslate"><span class="pre">de.unistuttgart.t2.&lt;service-name&gt;.repository</span></code></li>
<li><code class="file docutils literal notranslate"><span class="pre">de.unistuttgart.t2.&lt;service-name&gt;.exception</span></code></li>
<li><code class="file docutils literal notranslate"><span class="pre">de.unistuttgart.t2.&lt;service-name&gt;.domain</span></code></li>
</ul>
<p>Each service has a subset of those packages, as visualized in the diagram below.
The diagram reads as follows:
Orchestrator has the <em>&lt;service-name&gt;</em> package and a packages <em>saga</em>, Order and Inventory have those packages and also a package <em>repository</em>, and so on.</p>
<img alt="../_images/packages.jpg" src="../_images/packages.jpg" />
<div class="section" id="de-unistuttgart-t2-service-name">
<h3>de.unistuttgart.t2.&lt;service-name&gt;<a class="headerlink" href="#de-unistuttgart-t2-service-name" title="Permalink to this headline">¶</a></h3>
<p>The app package contains the following classes, usually prefixed with the service name.
E.g the application class of the Order Service is called <em>OrderApplication</em>, the controller is called <em>OrderController</em> and so on.</p>
<ul class="simple">
<li>Application : annotated with &#64;SpringBootApplication.</li>
<li>Service : contains the logic of the service.</li>
<li>Controller : defines the HTTP endpoint of the service.
This class is only present, if the service has HTTP endpoints.</li>
</ul>
<p>Services with complicated configurations have an additional config package that contains the various configuration classes.</p>
</div>
<div class="section" id="de-unistuttgart-t2-service-name-saga">
<h3>de.unistuttgart.t2.&lt;service-name&gt;.saga<a class="headerlink" href="#de-unistuttgart-t2-service-name-saga" title="Permalink to this headline">¶</a></h3>
<p>The saga package contains classes that are saga specific.
For the participants:</p>
<ul class="simple">
<li>CommandHandler : handles incoming messages.</li>
</ul>
<p>For the orchestrator:</p>
<ul class="simple">
<li>Saga : definition of the saga.</li>
</ul>
</div>
<div class="section" id="de-unistuttgart-t2-service-name-repository">
<h3>de.unistuttgart.t2.&lt;service-name&gt;.repository<a class="headerlink" href="#de-unistuttgart-t2-service-name-repository" title="Permalink to this headline">¶</a></h3>
<p>The repository packages contain all classes and interfaces for the domain databases.</p>
<ul class="simple">
<li>Item : the items in the database.</li>
<li>Repository : an Interface that extends Spring’s <a class="reference external" href="https://docs.spring.io/spring-data/mongodb/docs/current/api/org/springframework/data/mongodb/repository/MongoRepository.html">MongoRepository</a> to access the database.</li>
</ul>
</div>
<div class="section" id="de-unistuttgart-t2-service-name-exceptions">
<h3>de.unistuttgart.t2.&lt;service-name&gt;.exceptions<a class="headerlink" href="#de-unistuttgart-t2-service-name-exceptions" title="Permalink to this headline">¶</a></h3>
<p>Any kind of service specific exceptions can be found here.</p>
</div>
<div class="section" id="de-unistuttgart-t2-service-name-domain">
<h3>de.unistuttgart.t2.&lt;service-name&gt;.domain<a class="headerlink" href="#de-unistuttgart-t2-service-name-domain" title="Permalink to this headline">¶</a></h3>
<p>Any classes that represent something domain specific, but does not belong into the repository package.
Most domain specific things are used by multiple services and thus located in the common package, however things that only one service needs are located here.</p>
</div>
</div>
<div class="section" id="links">
<h2>Links<a class="headerlink" href="#links" title="Permalink to this headline">¶</a></h2>
<p>For more Details on each service, look at the repositories or the API documentation:</p>
<ul class="simple">
<li>Order service: <a class="reference external" href="https://github.com/t2-project/order">GitHub</a>, <a class="reference internal" href="../javadoc/order/packages.html#order"><span class="std std-ref">JavaDoc</span></a></li>
<li>Inventory service: <a class="reference external" href="https://github.com/t2-project/inventory">GitHub</a>, <a class="reference internal" href="../javadoc/inventory/packages.html#inventory"><span class="std std-ref">JavaDoc</span></a></li>
<li>Payment service: <a class="reference external" href="https://github.com/t2-project/payment">GitHub</a>, <a class="reference internal" href="../javadoc/payment/packages.html#payment"><span class="std std-ref">JavaDoc</span></a></li>
<li>Orchestrator service: <a class="reference external" href="https://github.com/t2-project/orchestrator">GitHub</a>, <a class="reference internal" href="../javadoc/orchestrator/packages.html#orchestrator"><span class="std std-ref">JavaDoc</span></a></li>
<li>Cart service: <a class="reference external" href="https://github.com/t2-project/cart">GitHub</a>, <a class="reference internal" href="../javadoc/cart/packages.html#cart"><span class="std std-ref">JavaDoc</span></a></li>
<li>Credit Institute service: <a class="reference external" href="https://github.com/t2-project/creditinstitute">GitHub</a>, <a class="reference internal" href="../javadoc/creditinstitute/packages.html#creditinstitute"><span class="std std-ref">JavaDoc</span></a></li>
<li>UIBackend : <a class="reference external" href="https://github.com/t2-project/uibackend">GitHub</a>, <a class="reference internal" href="../javadoc/uibackend/packages.html#uibackend"><span class="std std-ref">JavaDoc</span></a></li>
<li>UI : <a class="reference external" href="https://github.com/t2-project/ui">GitHub</a>, <a class="reference internal" href="../javadoc/ui/packages.html#ui"><span class="std std-ref">JavaDoc</span></a></li>
<li>Common: <a class="reference external" href="https://github.com/t2-project/common">GitHub</a>, <a class="reference internal" href="../javadoc/common/packages.html#common"><span class="std std-ref">JavaDoc</span></a></li>
<li>E2E Test: <a class="reference external" href="https://github.com/t2-project/e2e-tests">GitHub</a>, <a class="reference internal" href="../javadoc/e2etest/packages.html#eetest"><span class="std std-ref">JavaDoc</span></a></li>
</ul>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">T2 Store</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">ARCHITECTURE</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Architecture Overview</a></li>
</ul>
<p class="caption"><span class="caption-text">HOWTOS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../guides/kube.html">Run on a Kubernetes Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/kube.html#run-locally">Run Locally</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/kube.html#run-with-test-service">Run with Test Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/kube.html#load-generation">Load Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/kube.html#prometheus">Prometheus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/kube.html#jaeger-opentracing">jaeger / opentracing</a></li>
</ul>
<p class="caption"><span class="caption-text">JAVADOC</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../javadoc/common/packages.html">common</a></li>
<li class="toctree-l1"><a class="reference internal" href="../javadoc/order/packages.html">order</a></li>
<li class="toctree-l1"><a class="reference internal" href="../javadoc/payment/packages.html">payment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../javadoc/inventory/packages.html">inventory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../javadoc/orchestrator/packages.html">orchestrator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../javadoc/uibackend/packages.html">uibackend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../javadoc/ui/packages.html">ui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../javadoc/cart/packages.html">cart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../javadoc/creditinstitute/packages.html">creditinstitute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../javadoc/e2etest/packages.html">e2etest</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../index.html" title="previous chapter">T2 Store Documentation</a></li>
      <li>Next: <a href="../guides/kube.html" title="next chapter">Run on a Kubernetes Cluster</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Sarah Sophie Stieß.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/arch/arch.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>